<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_0ia7fl5" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.33.1" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.21.0">
  <bpmn:process id="examRegistration" name="exam-registration" isExecutable="true" camunda:historyTimeToLive="30">
    <bpmn:startEvent id="StartEvent_1" name="course registration started">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="studentEmail" label="E-Mail" type="string" />
          <camunda:formField id="courseName" label="Course Name" type="string">
            <camunda:properties />
          </camunda:formField>
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:outgoing>Flow_13upj83</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_13upj83" sourceRef="StartEvent_1" targetRef="studentExistsDelegate" />
    <bpmn:serviceTask id="studentExistsDelegate" name="Initial existence check " camunda:delegateExpression="${studentService.initialCheckDelegate(execution.getVariable(&#39;courseName&#39;),execution.getVariable(&#39;studentEmail&#39;), execution)}">
      <bpmn:incoming>Flow_13upj83</bpmn:incoming>
      <bpmn:outgoing>Flow_0lgnx1k</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_0df0mu6" name="approved?">
      <bpmn:incoming>Flow_0lgnx1k</bpmn:incoming>
      <bpmn:outgoing>Flow_1k1rj57</bpmn:outgoing>
      <bpmn:outgoing>Flow_1ux4ko6</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0lgnx1k" sourceRef="studentExistsDelegate" targetRef="Gateway_0df0mu6" />
    <bpmn:endEvent id="Event_1dsto9u" name="application rejected">
      <bpmn:incoming>Flow_1k1rj57</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_1k1rj57" name="no" sourceRef="Gateway_0df0mu6" targetRef="Event_1dsto9u">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!approved}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1ux4ko6" name="yes" sourceRef="Gateway_0df0mu6" targetRef="checkRegistrationDeadlineDMN">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approved}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:exclusiveGateway id="Gateway_1lu1mxj" name="registration in deadline?">
      <bpmn:incoming>Flow_1oqzs2e</bpmn:incoming>
      <bpmn:outgoing>Flow_035de0m</bpmn:outgoing>
      <bpmn:outgoing>Flow_1iox8zr</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1oqzs2e" sourceRef="checkRegistrationDeadlineDMN" targetRef="Gateway_1lu1mxj" />
    <bpmn:sequenceFlow id="Flow_035de0m" name="no" sourceRef="Gateway_1lu1mxj" targetRef="userTaskCancelOrApply">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!registrationAllowed}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="userTaskCancelOrApply" name="Select application with justification or cancel" camunda:candidateGroups="students">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="cancelRegistration" label="Cancel" type="boolean" defaultValue="false">
            <camunda:validation />
          </camunda:formField>
          <camunda:formField id="justification" label="Justification" type="string" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_035de0m</bpmn:incoming>
      <bpmn:outgoing>Flow_1hmth07</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_05huf6g" name="cancel registration?">
      <bpmn:incoming>Flow_1hmth07</bpmn:incoming>
      <bpmn:outgoing>Flow_047b1dt</bpmn:outgoing>
      <bpmn:outgoing>Flow_06r5348</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1hmth07" sourceRef="userTaskCancelOrApply" targetRef="Gateway_05huf6g" />
    <bpmn:endEvent id="Event_1vnxayh" name="registration stopped">
      <bpmn:incoming>Flow_047b1dt</bpmn:incoming>
      <bpmn:incoming>Flow_1dndxjg</bpmn:incoming>
      <bpmn:incoming>Flow_16khaca</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_047b1dt" name="yes" sourceRef="Gateway_05huf6g" targetRef="Event_1vnxayh">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${cancelRegistration}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:boundaryEvent id="Event_0dck6ee" name="after 7 days" attachedToRef="userTaskCancelOrApply">
      <bpmn:outgoing>Flow_1dndxjg</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_0xpbhhh">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">P7D</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_1dndxjg" sourceRef="Event_0dck6ee" targetRef="Event_1vnxayh" />
    <bpmn:sequenceFlow id="Flow_06r5348" name="no" sourceRef="Gateway_05huf6g" targetRef="userTaskOfficeCheck">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!cancelRegistration}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="userTaskOfficeCheck" name="Examination office checks justification" camunda:candidateGroups="examOffice">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="justification" label="Students Justification" type="string">
            <camunda:properties />
            <camunda:validation>
              <camunda:constraint name="readonly" />
            </camunda:validation>
          </camunda:formField>
          <camunda:formField id="acceptJustification" label="Accept" type="boolean" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_06r5348</bpmn:incoming>
      <bpmn:outgoing>Flow_14h8smp</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_1tu7dt0" name="registration accepted?">
      <bpmn:incoming>Flow_14h8smp</bpmn:incoming>
      <bpmn:outgoing>Flow_16khaca</bpmn:outgoing>
      <bpmn:outgoing>Flow_1gj1ck8</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_14h8smp" sourceRef="userTaskOfficeCheck" targetRef="Gateway_1tu7dt0" />
    <bpmn:sequenceFlow id="Flow_16khaca" name="no" sourceRef="Gateway_1tu7dt0" targetRef="Event_1vnxayh">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!acceptJustification}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1iox8zr" name="yes" sourceRef="Gateway_1lu1mxj" targetRef="Activity_0dz597f">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${registrationAllowed}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_1gj1ck8" name="yes" sourceRef="Gateway_1tu7dt0" targetRef="Activity_0dz597f">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${acceptJustification}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="Event_115yy1a" name="registration successful">
      <bpmn:incoming>Flow_1gpdv14</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:businessRuleTask id="checkRegistrationDeadlineDMN" name="Check if registration is within deadline" camunda:resultVariable="registrationAllowed" camunda:decisionRef="checkExamRegistrationDeadline" camunda:mapDecisionResult="singleEntry">
      <bpmn:incoming>Flow_1ux4ko6</bpmn:incoming>
      <bpmn:outgoing>Flow_1oqzs2e</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:sequenceFlow id="Flow_1gpdv14" sourceRef="Activity_0dz597f" targetRef="Event_115yy1a" />
    <bpmn:serviceTask id="Activity_0dz597f" name="Enroll for exam" camunda:delegateExpression="${studentService.assignCourseDelegate(execution.getVariable(&#39;studentEmail&#39;), execution)}">
      <bpmn:incoming>Flow_1iox8zr</bpmn:incoming>
      <bpmn:incoming>Flow_1gj1ck8</bpmn:incoming>
      <bpmn:outgoing>Flow_1gpdv14</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:textAnnotation id="TextAnnotation_1argorg">
      <bpmn:text>checks if student and course are valid and if the student is already registered to this course</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_09mglk5" associationDirection="None" sourceRef="studentExistsDelegate" targetRef="TextAnnotation_1argorg" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="examRegistration">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="162" y="289" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="154" y="332" width="55" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_003w6a7_di" bpmnElement="studentExistsDelegate">
        <dc:Bounds x="290" y="267" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0df0mu6_di" bpmnElement="Gateway_0df0mu6" isMarkerVisible="true">
        <dc:Bounds x="455" y="282" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="455" y="263" width="52" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1dsto9u_di" bpmnElement="Event_1dsto9u">
        <dc:Bounds x="1532" y="289" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1526" y="332" width="53" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1lu1mxj_di" bpmnElement="Gateway_1lu1mxj" isMarkerVisible="true">
        <dc:Bounds x="755" y="515" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="746" y="477.5" width="67" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0qnylg5_di" bpmnElement="userTaskCancelOrApply">
        <dc:Bounds x="880" y="500" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_05huf6g_di" bpmnElement="Gateway_05huf6g" isMarkerVisible="true">
        <dc:Bounds x="1055" y="515" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1049" y="486.5" width="61" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1vnxayh_di" bpmnElement="Event_1vnxayh">
        <dc:Bounds x="1532" y="522" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1577.5" y="526" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0qx8mlq_di" bpmnElement="userTaskOfficeCheck">
        <dc:Bounds x="1030" y="630" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1tu7dt0_di" bpmnElement="Gateway_1tu7dt0" isMarkerVisible="true">
        <dc:Bounds x="1195" y="645" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1192" y="607.5" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_115yy1a_di" bpmnElement="Event_115yy1a">
        <dc:Bounds x="1532" y="802" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1524" y="845" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1jwh4wd_di" bpmnElement="checkRegistrationDeadlineDMN">
        <dc:Bounds x="580" y="500" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0drrn7f_di" bpmnElement="Activity_0dz597f">
        <dc:Bounds x="1170" y="780" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1argorg_di" bpmnElement="TextAnnotation_1argorg">
        <dc:Bounds x="380" y="80" width="140" height="90" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_18q8jnm_di" bpmnElement="Event_0dck6ee">
        <dc:Bounds x="962" y="482" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="911" y="473" width="58" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_13upj83_di" bpmnElement="Flow_13upj83">
        <di:waypoint x="198" y="307" />
        <di:waypoint x="290" y="307" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0lgnx1k_di" bpmnElement="Flow_0lgnx1k">
        <di:waypoint x="390" y="307" />
        <di:waypoint x="455" y="307" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1k1rj57_di" bpmnElement="Flow_1k1rj57">
        <di:waypoint x="505" y="307" />
        <di:waypoint x="1532" y="307" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1021" y="289" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ux4ko6_di" bpmnElement="Flow_1ux4ko6">
        <di:waypoint x="480" y="332" />
        <di:waypoint x="480" y="540" />
        <di:waypoint x="580" y="540" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="521" y="523" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1oqzs2e_di" bpmnElement="Flow_1oqzs2e">
        <di:waypoint x="680" y="540" />
        <di:waypoint x="755" y="540" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_035de0m_di" bpmnElement="Flow_035de0m">
        <di:waypoint x="805" y="540" />
        <di:waypoint x="880" y="540" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="836" y="522" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1hmth07_di" bpmnElement="Flow_1hmth07">
        <di:waypoint x="980" y="540" />
        <di:waypoint x="1055" y="540" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_047b1dt_di" bpmnElement="Flow_047b1dt">
        <di:waypoint x="1105" y="540" />
        <di:waypoint x="1532" y="540" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1310" y="522" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dndxjg_di" bpmnElement="Flow_1dndxjg">
        <di:waypoint x="980" y="482" />
        <di:waypoint x="980" y="450" />
        <di:waypoint x="1550" y="450" />
        <di:waypoint x="1550" y="522" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_06r5348_di" bpmnElement="Flow_06r5348">
        <di:waypoint x="1080" y="565" />
        <di:waypoint x="1080" y="630" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1089" y="595" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_14h8smp_di" bpmnElement="Flow_14h8smp">
        <di:waypoint x="1130" y="670" />
        <di:waypoint x="1195" y="670" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_16khaca_di" bpmnElement="Flow_16khaca">
        <di:waypoint x="1245" y="670" />
        <di:waypoint x="1550" y="670" />
        <di:waypoint x="1550" y="560" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1532" y="618" width="13" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1iox8zr_di" bpmnElement="Flow_1iox8zr">
        <di:waypoint x="780" y="565" />
        <di:waypoint x="780" y="820" />
        <di:waypoint x="1170" y="820" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="865" y="803" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1gj1ck8_di" bpmnElement="Flow_1gj1ck8">
        <di:waypoint x="1220" y="695" />
        <di:waypoint x="1220" y="780" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1226" y="735" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1gpdv14_di" bpmnElement="Flow_1gpdv14">
        <di:waypoint x="1270" y="820" />
        <di:waypoint x="1532" y="820" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_09mglk5_di" bpmnElement="Association_09mglk5">
        <di:waypoint x="359" y="267" />
        <di:waypoint x="404" y="170" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
